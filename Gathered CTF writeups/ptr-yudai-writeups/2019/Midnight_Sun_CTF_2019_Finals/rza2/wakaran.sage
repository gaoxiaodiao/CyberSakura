n = 4881732913768637300889684328062148853799028265275280011337359682419567577773776065683568939880697109310913269208674091085030738542806078421018604128522968693113540479252055019413277780816511188273358663446983100327369922417328342366373856963063026238502985993569752927941705995685771884114903350045553888279616048746166274475638839707853977909703396119744842651482656236592044589285970385372403997863085802273635128052217360253928177224092274458661
real_q = 69869398979586458876460148647190282809559877127825663622440084111348849172795057053241565869864197258287695277834389490646982395532070866577267975263253580285441205741822981558341412018563416867412100186153185868403762410247
real_p = 69869398979586458876460148647190282809559877127825663622440084111348845127364861172819899863962313272799962636465335731526297316494338026110377375291418532509990942688176298568305185838031218637740096779555111903352653237363
a = 12382970203020501429935890147897748556401818591497868579985800095980544
pbits = 744

#n = 118173998641659433141031218423093267548048945830460552160732748274571974743297930821423113390029083098858035838064885829588967199550126084897009304331836294104589302387252278933370240317467378376797843379485665856003112996215247651060003047081838833325054418881162956647931078011461049685774070539302432802113792476309961767049580409488915273417272971605423056480946448420246170538977427027687185230659802277819960185028241326766028592105200802992171
#a = 47702774091583083413514954181005338733744246354146014100833529117112767
#pbits = 746

nn = RealField(2000)(n)

for t1 in range(1, 512, 4):
    for t2 in range(1, 512, 4):
        #r1 = 2 ^ t1
        #r2 = 2 ^ t2
        r1 = randint(0, 2^512)
        r2 = randint(0, 2^512)
        qq = isqrt(nn * (1 + r2/(a*r1)))
        beta = 0.5
        epsilon = beta ^ 2 / 7
        kbits = floor(pbits*2 * (beta^2-epsilon))
        qbar = qq & (2 ^ pbits - 2 ^ kbits)
        PR.<x> = PolynomialRing(Zmod(n))
        f = qbar + x
        roots = f.small_roots(X=2^kbits, beta=0.3)
        if roots:
            x0 = roots[0]
            print(qbar + x0)
