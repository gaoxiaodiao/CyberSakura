#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include <unistd.h>
#include <sys/types.h>
/*
 * compiled with:
 * gcc -m32 -O0 -fno-stack-protector pwn1.c -o pwn1
 *
 * Credits: The amazing RPISEC Modern Binary Exploitation (MBE) course
 */

void shell()
{
    printf("You did it.\n");
    system("/bin/sh");
}

int main(int argc, char** argv)
{
    setvbuf(stdout, 0, 2, 0);

    int set_me = 0;
    char buf[15];

    printf("Enter a message: ");
    gets(buf);

    if(set_me == 0xdeadbeef) {
        shell();
    }
    else {
        printf("Not authenticated.\nset_me was %x\n", set_me);
    }

    return EXIT_SUCCESS;
}
